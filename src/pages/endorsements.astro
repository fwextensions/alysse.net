---
import Layout from "../layouts/Layout.astro";
import HeroSection from "../components/HeroSection.astro";
import EndorsementList from "../components/EndorsementList.astro";
import Carousel from "../components/Carousel.astro";
import featuredEndorsementsJson from "../content/featured-endorsements/list.json";
import { Image } from "astro:assets";
import { getCollection, getEntry } from "astro:content";

// fetch page config with category order
const pageConfig = await getEntry("endorsementsPage", "config");
const order2026 = pageConfig?.data?.order2026 || [];
const order2022 = pageConfig?.data?.order2022 || [];

// fetch all endorsement categories
const allCategories = await getCollection("endorsementCategories");

// build endorsements data in the specified order
const endorsements2026 = order2026
	.map((categoryID) => allCategories.find((cat) => cat.id === categoryID))
	.filter((cat) => cat !== undefined)
	.map((cat) => ({
		category: cat.data.name,
		endorsements: cat.data.endorsements || [],
	}));

const endorsements2022 = order2022
	.map((categoryID) => allCategories.find((cat) => cat.id === categoryID))
	.filter((cat) => cat !== undefined)
	.map((cat) => ({
		category: cat.data.name,
		endorsements: cat.data.endorsements || [],
	}));

// fetch gallery data
const galleryEntries = await getCollection("endorsementsGallery");
const galleryData = galleryEntries[0]?.data?.endorsements || [];

---

<Layout title="Endorsements">
	<HeroSection
		title="Endorsements"
		subtitle="An emerging list of partners and supporters who have endorsed before the 2026 campaign launches in January. Many more to come!"
		centered={true}
	/>

	<section class="py-16 px-4 bg-white">
		<div class="max-w-7xl mx-auto space-y-16">
			{
				endorsements2026.map((group) => (
					<EndorsementList
						category={group.category}
						endorsements={group.endorsements}
					/>
				))
			}

			{
				endorsements2022.length > 0 && (
					<div class="pt-16">
						<h2 class="text-4xl font-bold text-center mb-12">
							2022 Endorsements
						</h2>
						{endorsements2022.map((group) => (
							<EndorsementList
								category={group.category}
								endorsements={group.endorsements}
							/>
						))}
					</div>
				)
			}

			<div class="pt-16">
				<h2 class="text-4xl font-bold mb-16 text-center">
					Alysse is supported by educators and community leaders
				</h2>
				<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
					{
						galleryData.map((person) => (
							<div class="flex flex-col items-center text-center space-y-3">
								<Image
									src={person.photo}
									alt={person.name}
									class="w-40 h-40 object-cover"
									width={128}
									height={128}
								/>
								<div>
									<h3 class="font-bold">{person.name}</h3>
									<p class="text-sm leading-tight">{person.title}</p>
								</div>
							</div>
						))
					}
				</div>
			</div>
		</div>
	</section>

	<Carousel data={featuredEndorsementsJson} />
</Layout>
