---
import Layout from "../layouts/Layout.astro";
import HeroSection from "../components/HeroSection.astro";
import EndorsementList from "../components/EndorsementList.astro";
import Carousel from "../components/Carousel.astro";
import featuredEndorsementsJson from "../content/featured-endorsements/list.json";
import { Image } from "astro:assets";
import { getCollection, getEntry } from "astro:content";

// endorsement categories with their display names
const endorsementCategories = [
	{ collection: "endorsementsAlamedaCountyLeaders", category: "Alameda County Leaders" },
	{ collection: "endorsementsCityStateLeaders", category: "City and State Leaders" },
	{ collection: "endorsementsEducationLeaders", category: "Education Leaders" },
	{ collection: "endorsementsEducation", category: "Education" },
	{ collection: "endorsementsTeachersAssociations", category: "Teachers Associations" },
	{ collection: "endorsementsFormerAcoeLeaders", category: "Former ACOE Leaders" },
	{ collection: "endorsementsPoliticalOrganizations", category: "Political Organizations" },
	{ collection: "endorsementsElectedOfficials", category: "Elected and Appointed Officials" },
	{ collection: "endorsementsLabor", category: "Labor" },
] as const;

// fetch all endorsement categories
const endorsementsData = await Promise.all(
	endorsementCategories.map(async ({ collection, category }) => {
		const entries = await getCollection(collection);
		const data = entries[0]?.data;
		return { category, endorsements: data?.endorsements || [] };
	})
);

// fetch gallery data
const galleryEntries = await getCollection("endorsementsGallery");
const galleryData = galleryEntries[0]?.data?.endorsements || [];

---

<Layout title="Endorsements">
	<HeroSection
		title="Endorsements"
		subtitle="An emerging list of partners and supporters who have endorsed before the 2026 campaign launches in January. Many more to come!"
		centered={true}
	/>

	<section class="py-16 px-4 bg-white">
		<div class="max-w-7xl mx-auto space-y-16">
			{
				endorsementsData.map((group) => (
					<EndorsementList
						category={group.category}
						endorsements={group.endorsements}
					/>
				))
			}

			<div class="pt-16">
				<h2 class="text-3xl mb-16 text-center">
					Alysse is supported by educators and community leaders
				</h2>
				<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
					{
						galleryData.map((person) => (
							<div class="flex flex-col items-center text-center space-y-3">
								<Image
									src={person.photo}
									alt={person.name}
									class="w-40 h-40 object-cover"
									width={128}
									height={128}
								/>
								<div>
									<h3 class="font-bold">{person.name}</h3>
									<p class="text-sm leading-tight">{person.title}</p>
								</div>
							</div>
						))
					}
				</div>
			</div>
		</div>
	</section>

	<Carousel data={featuredEndorsementsJson} />
</Layout>
