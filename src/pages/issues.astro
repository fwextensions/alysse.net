---
import Layout from "../layouts/Layout.astro";
import HeroSection from "../components/HeroSection.astro";
import TextSection from "../components/TextSection.astro";
import CTASection from "../components/CTASection.astro";
import { getCollection, render } from "astro:content";

// fetch issues page config
const issuesPageEntries = await getCollection("issuesPage");
const issuesPageConfig = issuesPageEntries[0]?.data;

// fetch all issues
const allIssues = await getCollection("issues");

// order issues according to config, or use all if no config
const orderedIssues = issuesPageConfig?.issueOrder
	? issuesPageConfig.issueOrder
		.map((slug: string) => allIssues.find((issue) => issue.id.replace("/index", "") === slug))
		.filter(Boolean)
	: allIssues;

// render all issue content
const issuesWithContent = await Promise.all(
	orderedIssues.map(async (issue: any) => {
		const { Content } = await render(issue);
		return { ...issue, Content };
	})
);
---

<Layout title="Issues">
	<HeroSection
		title={issuesPageConfig?.heroTitle || "Quality & Equality"}
		subtitle={issuesPageConfig?.heroSubtitle || "It won't happen by chance. It happens by change."}
		centered={true}
	/>

	<div class="grid grid-cols-1 md:grid-cols-2 gap-12">
		{
			issuesWithContent.map((issue) => (
				<TextSection
					heading={issue.data.heading}
					maxWidth="medium"
					content=""
					imageSrc={issue.data.image}
					imageAlt={issue.data.imageAlt}
					imagePosition="top"
					padding="medium"
					headerPosition="bottom"
					class="h-full"
				>
					<div class="prose">
						<issue.Content />
					</div>
				</TextSection>
			))
		}
	</div>

	<CTASection
		heading="Be Part of the Change"
		description="Join Alysse in building a better future for all Alameda County students"
		primaryButtonText="Volunteer"
		primaryButtonLink="/volunteer"
		secondaryButtonText="Donate"
		secondaryButtonLink="/donate"
		backgroundColor="gradient"
	/>
</Layout>
